let ipLocation,year,month,week,date,dates,weekStr,monthStr,asideTime,asideDay,asideDayNum,animalYear,ganzhiYear,lunarMon,lunarDay;function getDistance(e,a,t,n){const{sin:r,cos:o,asin:s,PI:i,hypot:c}=Math;let d=(e,a)=>(e*=i/180,{x:o(a*=i/180)*o(e),y:o(a)*r(e),z:r(a)}),l=d(e,a),u=d(t,n),y=2*s(c(l.x-u.x,l.y-u.y,l.z-u.z)/2)*6371;return Math.round(y)}function showWelcome(){if(!ipLocation||!ipLocation.data)return void console.error("ipLocation data is not available.");let e,a,t=getDistance(108.8764,34.1452,ipLocation.data.lng,ipLocation.data.lat),n=ipLocation.data.country;ipLocation.ip;switch(ipLocation.data.country){case"æ—¥æœ¬":e="ã‚ˆã‚ã—ãï¼Œä¸€èµ·å»çœ‹æ¨±èŠ±å—";break;case"ç¾å›½":e="Let us live in peace!";break;case"è‹±å›½":e="æƒ³åŒä½ ä¸€èµ·å¤œä¹˜ä¼¦æ•¦çœ¼";break;case"ä¿„ç½—æ–¯":e="å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼";break;case"æ³•å›½":e="C'est La Vie";break;case"å¾·å›½":e="Die Zeit verging im Fluge.";break;case"æ¾³å¤§åˆ©äºš":e="ä¸€èµ·å»å¤§å ¡ç¤å§ï¼";break;case"åŠ æ‹¿å¤§":e="æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ ";break;case"ä¸­å›½":switch(n=ipLocation.data.prov+" "+ipLocation.data.city+" "+ipLocation.data.district,ipLocation.data.prov){case"åŒ—äº¬å¸‚":e="åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~";break;case"ä¸Šæµ·å¸‚":e="èµ°åœ¨å¤–æ»©ï¼Œæ„Ÿå—å†å²ä¸ç°ä»£çš„äº¤èã€‚";break;case"å¹¿ä¸œçœ":switch(ipLocation.data.city){case"å¹¿å·å¸‚":e="çœ‹å°è›®è…°ï¼Œå–æ—©èŒ¶äº†å˜›~";break;case"æ·±åœ³å¸‚":e="ä»Šå¤©ä½ é€›å•†åœºäº†å˜›~";break;default:e="å¸¦ä½ æ„Ÿå—å¹¿ä¸œçš„çƒ­æƒ…ä¸ç¾é£Ÿï¼"}break;case"æµ™æ±Ÿçœ":switch(ipLocation.data.city){case"æ­å·å¸‚":e="è¥¿æ¹–ç¾æ™¯ï¼Œä¸‰æœˆå¤©~";break;case"å®æ³¢å¸‚":e="æ¥å®æ³¢ï¼Œæ„Ÿå—å¤§æµ·çš„æ°”æ¯ã€‚";break;default:e="è¿™é‡Œæ˜¯æµ™æ±Ÿï¼Œå……æ»¡æ±Ÿå—çš„éŸµå‘³ï¼"}break;case"å››å·çœ":switch(ipLocation.data.city){case"æˆéƒ½å¸‚":e="å®½çª„å··å­ï¼Œæˆéƒ½æ…¢ç”Ÿæ´»ã€‚";break;case"ç»µé˜³å¸‚":e="äº«å—ç§‘æŠ€åŸçš„å®é™ä¸åˆ›æ–°ã€‚";break;default:e="æ¥å››å·ï¼Œå“éº»è¾£ç«é”…ï¼Œèµå£®ä¸½å±±æ²³ã€‚"}break;case"ç¦å»ºçœ":switch(ipLocation.data.city){case"å¦é—¨å¸‚":e="é¼“æµªå±¿å¬æµ·ï¼Œå¦é—¨ç¾é£Ÿè®©äººæµè¿å¿˜è¿”ã€‚";break;case"ç¦å·å¸‚":e="æœ‰ç¦ä¹‹å·ï¼Œæ¥æ­¤æ„Ÿå—åƒå¹´å¤åŸã€‚";break;default:e="ç¦å»ºå±±æ°´å¦‚ç”»ï¼Œç¾æ™¯æ— å¤„ä¸åœ¨ã€‚"}break;case"å±±ä¸œçœ":switch(ipLocation.data.city){case"é’å²›å¸‚":e="æ¥é’å²›å–å•¤é…’ï¼Œçœ‹å¤§æµ·å§ï¼";break;case"æµå—å¸‚":e="æ³‰åŸæµå—ï¼Œå››é¢è·èŠ±ä¸‰é¢æŸ³ã€‚";break;default:e="å±±ä¸œå¥½å®¢ï¼Œæ¬¢è¿æ¥æ„Ÿå—é½é²æ–‡åŒ–ï¼"}break;case"æ±Ÿè‹çœ":switch(ipLocation.data.city){case"å—äº¬å¸‚":e="å…­æœå¤éƒ½å—äº¬ï¼Œå†å²ä¸ç°ä»£çš„ç¢°æ’ã€‚";break;case"è‹å·å¸‚":e="æ¥è‹å·ï¼Œæ„Ÿå—å›­æ—ä¹‹ç¾ã€‚";break;default:e="æ°´ä¹¡æ³½å›½ï¼Œæ±Ÿå—ä½³ä¸½åœ°ã€‚"}break;case"æ²³åŒ—çœ":e="ç‡•èµµå¤§åœ°ï¼Œè‹±é›„è¾ˆå‡ºçš„æ²³åŒ—ï¼Œç­‰ä½ æ¢ç´¢ï¼";break;case"æ²³å—çœ":switch(ipLocation.data.city){case"éƒ‘å·å¸‚":e="ä¸­åŸå¤§åœ°ï¼Œéƒ‘å·æ˜¯äº¤é€šæ¢çº½ä¸å†å²é‡é•‡ã€‚";break;case"æ´›é˜³å¸‚":e="åƒå¹´å¤éƒ½æ´›é˜³ï¼Œç‰¡ä¸¹èŠ±å¼€çš„åŸå¸‚ã€‚";break;default:e="è¿™é‡Œæ˜¯æ²³å—ï¼Œå†å²æ‚ ä¹…æ–‡åŒ–ç¿çƒ‚ã€‚"}break;case"æ¹–å—çœ":if("é•¿æ²™å¸‚"===ipLocation.data.city)e="çƒ­è¾£é•¿æ²™ï¼Œåƒå°é¾™è™¾é€›é»„å…´è·¯æ­¥è¡Œè¡—ã€‚";else e="æ¹–å—ï¼ŒçƒŸé›¨è¿·è’™çš„æ¹˜æ±Ÿæµè¿‡è¿™ç‰‡åœŸåœ°ã€‚";break;case"æ¹–åŒ—çœ":if("æ­¦æ±‰å¸‚"===ipLocation.data.city)e="æ¥å¤§æ­¦æ±‰ï¼Œè¿‡é•¿æ±Ÿå¤§æ¡¥ï¼Œåƒçƒ­å¹²é¢ï¼";else e="æ¹–åŒ—ï¼Œé•¿æ±Ÿä¸­æ¸¸çš„æ˜ç ï¼Œé£æ™¯ç§€ä¸½ã€‚";break;case"å®‰å¾½çœ":if("åˆè‚¥å¸‚"===ipLocation.data.city)e="åˆ›æ–°ä¹‹åŸåˆè‚¥ï¼Œç§‘æ•™æ–‡åŒ–æ±‡èšåœ°ã€‚";else e="å®‰å¾½å±±æ°´ï¼Œé»„å±±ã€ä¹åå±±æ¬¢è¿ä½ ã€‚";break;case"å¹¿è¥¿å£®æ—è‡ªæ²»åŒº":switch(ipLocation.data.city){case"æ¡‚æ—å¸‚":e="æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹ï¼Œé£æ™¯å¦‚ç”»ã€‚";break;case"å—å®å¸‚":e="ç»¿åŸå—å®ï¼Œå®œå±…å®œæ¸¸ã€‚";break;default:e="å¹¿è¥¿å±±æ¸…æ°´ç§€ï¼Œæ°‘ä¿—é£æƒ…æµ“éƒã€‚"}break;case"è´µå·çœ":e="æ¥è´µå·ï¼Œå“èŒ…å°ï¼Œèµé»„æœæ ‘ç€‘å¸ƒã€‚";break;case"äº‘å—çœ":switch(ipLocation.data.city){case"æ˜†æ˜å¸‚":e="æ˜¥åŸæ˜†æ˜ï¼Œå››å­£å¦‚æ˜¥ï¼Œé£æ™¯ç§€ä¸½ã€‚";break;case"å¤§ç†å¸‚":e="è‹å±±æ´±æµ·ï¼Œå¤§ç†å¤åŸï¼Œä½ æ¥äº†å°±ä¸æƒ³èµ°ã€‚";break;default:e="äº‘å—é£æ™¯ç‹¬ç‰¹ï¼Œé£æƒ…ä¸‡ç§ã€‚"}break;case"è¥¿è—è‡ªæ²»åŒº":e="ä¸–ç•Œå±‹è„Šè¥¿è—ï¼Œç¥ç§˜è€Œçº¯å‡€ã€‚";break;case"æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº":e="è¾½é˜”æ–°ç–†ï¼Œæ°‘æ—é£æƒ…ä¸å£®ä¸½æ™¯è§‚å¹¶å­˜ã€‚";break;case"å†…è’™å¤è‡ªæ²»åŒº":e="è‰åŸè¾½é˜”çš„å†…è’™å¤ï¼Œç­‰ä½ æ¥ç­–é©¬å¥”è…¾ã€‚";break;case"å®å¤å›æ—è‡ªæ²»åŒº":e="å®å¤ï¼Œå¡ä¸Šæ±Ÿå—ï¼Œé»„æ²³æµç»çš„ç¾ä¸½åœ°æ–¹ã€‚";break;case"æµ·å—çœ":e="é˜³å…‰ã€æ²™æ»©ã€æ¤°é£æµ·éŸµï¼Œæ¬¢è¿æ¥æµ·å—åº¦å‡ã€‚";break;default:e="å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼"}break;default:e="å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§"}let r=new Date;a=r.getHours()>=5&&r.getHours()<11?"<span>ğŸŒ¤ï¸ æ—©ä¸Šå¥½ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨</span>":r.getHours()>=11&&r.getHours()<13?"<span>â˜€ï¸ ä¸­åˆå¥½ï¼Œè®°å¾—åˆä¼‘å–”~</span>":r.getHours()>=13&&r.getHours()<17?"<span>ğŸ• ä¸‹åˆå¥½ï¼Œé¥®èŒ¶å…ˆå•¦ï¼</span>":r.getHours()>=17&&r.getHours()<19?"<span>ğŸš¶â€â™‚ï¸ å³å°†ä¸‹ç­ï¼Œè®°å¾—æŒ‰æ—¶åƒé¥­~</span>":r.getHours()>=19&&r.getHours()<24?"<span>ğŸŒ™ æ™šä¸Šå¥½ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼</span>":"å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯ï¼Œå°‘ç†¬å¤œ";let o=document.getElementById("welcome-info");o&&(o.innerHTML=`æ¬¢è¿æ¥è‡ª <b><span style="color: var(--efu-main)">${n}</span></b> çš„å°å‹ğŸ’–<br>å½“å‰ä½ç½®è·åšä¸»çº¦ <b><span style="color: var(--efu-main)">${t.toFixed(2)}</span></b> å…¬é‡Œï¼<br>${a}<br>Tipï¼š<b><span style="font-size: 15px;">${e}</span></b>`)}function handlePjaxComplete(){isHomePage()&&showWelcome()}function isHomePage(){return"/"===window.location.pathname||"/index.html"===window.location.pathname}function initializeCard(){cardTimes(),cardRefreshTimes()}fetch("https://api.nsmao.net/api/ip/query?key=7s6oqQUBTNq57QBqeGWcr6Ff5s").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{ipLocation=e,isHomePage()&&showWelcome()})).catch((e=>console.error("Error:",e))),window.onload=function(){isHomePage()&&showWelcome(),document.addEventListener("pjax:complete",handlePjaxComplete)},document.addEventListener("DOMContentLoaded",(function(){async function e(){const e=document.getElementById("history-container");if(!e)return;const a=await async function(){const e=new Date,a=(`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),"https://api.nsmao.net/api/history/query?key=7s6oqQUBTNq57QBqeGWcr6Ff5s");try{const e=await fetch(a),t=await e.json();if(200===t.code){const e=t.data,a=Object.entries(e).map((([e,a])=>({year:e.replace(/å¹´$/,""),title:a})));return a}return console.error("Error fetching history data:",t.msg),[]}catch(e){return console.error("Fetch error:",e),[]}}(),t=a.map((e=>`\n            <div class="swiper-slide history_slide">\n                <span class="history_slide_time">A.D.${e.year}</span>\n                <span class="history_slide_link">${e.title}</span>\n            </div>\n        `)).join(""),n=document.querySelector(".history_swiper-container");document.getElementById("history_container_wrapper").innerHTML=t;const r=new Swiper(n,{loop:!0,direction:"vertical",autoplay:{disableOnInteraction:!0,delay:5e3},mousewheel:!1});e.onmouseenter=()=>r.autoplay.stop(),e.onmouseleave=()=>r.autoplay.start()}e(),document.addEventListener("pjax:complete",e),e(),document.addEventListener("pjax:complete",e)})),document.addEventListener("DOMContentLoaded",(()=>{initializeCard()})),document.addEventListener("pjax:complete",(()=>{initializeCard()}));const now=new Date;function cardRefreshTimes(){const e=document.getElementById("card-widget-schedule");e&&(asideDay=(now-asideTime)/1e3/60/60/24,e.querySelector("#pBar_year").value=asideDay,e.querySelector("#p_span_year").innerHTML=(asideDay/365*100).toFixed(1)+"%",e.querySelector(".schedule-r0 .schedule-d1 .aside-span2").innerHTML=`è¿˜å‰©<a> ${(365-asideDay).toFixed(0)} </a>å¤©`,e.querySelector("#pBar_month").value=date,e.querySelector("#pBar_month").max=dates,e.querySelector("#p_span_month").innerHTML=(date/dates*100).toFixed(1)+"%",e.querySelector(".schedule-r1 .schedule-d1 .aside-span2").innerHTML=`è¿˜å‰©<a> ${dates-date} </a>å¤©`,e.querySelector("#pBar_week").value=0===week?7:week,e.querySelector("#p_span_week").innerHTML=((0===week?7:week)/7*100).toFixed(1)+"%",e.querySelector(".schedule-r2 .schedule-d1 .aside-span2").innerHTML=`è¿˜å‰©<a> ${7-(0===week?7:week)} </a>å¤©`)}function cardTimes(){year=now.getFullYear(),month=now.getMonth(),week=now.getDay(),date=now.getDate();const e=document.getElementById("card-widget-calendar");if(e){weekStr=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][week];const a=[{month:"1æœˆ",days:31},{month:"2æœˆ",days:year%4==0&&year%100!=0||year%400==0?29:28},{month:"3æœˆ",days:31},{month:"4æœˆ",days:30},{month:"5æœˆ",days:31},{month:"6æœˆ",days:30},{month:"7æœˆ",days:31},{month:"8æœˆ",days:31},{month:"9æœˆ",days:30},{month:"10æœˆ",days:31},{month:"11æœˆ",days:30},{month:"12æœˆ",days:31}];monthStr=a[month].month,dates=a[month].days;const t=(week+8-date%7)%7;let n="",r=!1,o=7-t;const s=(dates-o)%7==0?Math.floor((dates-o)/7)+1:Math.floor((dates-o)/7)+2,i=e.querySelector("#calendar-main");e.querySelector("#calendar-date").style.fontSize=["64px","48px","36px"][Math.min(s-3,2)];for(let e=0;e<s;e++){i.querySelector(`.calendar-r${e}`)||(i.innerHTML+=`<div class='calendar-r${e}'></div>`);for(let a=0;a<7;a++){0===e&&a===t&&(n=1,r=!0);const o=n===date?" class='now'":"";i.querySelector(`.calendar-r${e} .calendar-d${a} a`)||(i.querySelector(`.calendar-r${e}`).innerHTML+=`<div class='calendar-d${a}'><a${o}>${n}</a></div>`),n>=dates&&(n="",r=!1),r&&(n+=1)}}const c=chineseLunar.solarToLunar(new Date(year,month,date));animalYear=chineseLunar.format(c,"A"),ganzhiYear=chineseLunar.format(c,"T").slice(0,-1),lunarMon=chineseLunar.format(c,"M"),lunarDay=chineseLunar.format(c,"d");const d=new Date("2026/02/17 00:00:00"),l=Math.floor((d-now)/1e3/60/60/24);asideTime=new Date(`${(new Date).getFullYear()}/01/01 00:00:00`),asideDay=(now-asideTime)/1e3/60/60/24,asideDayNum=Math.floor(asideDay);const u=week-asideDayNum%7>=0?Math.ceil(asideDayNum/7):Math.ceil(asideDayNum/7)+1;e.querySelector("#calendar-week").innerHTML=`ç¬¬${u}å‘¨&nbsp;${weekStr}`,e.querySelector("#calendar-date").innerHTML=date.toString().padStart(2,"0"),e.querySelector("#calendar-solar").innerHTML=`${year}å¹´${monthStr}&nbsp;ç¬¬${asideDay.toFixed(0)}å¤©`,e.querySelector("#calendar-lunar").innerHTML=`${ganzhiYear}${animalYear}å¹´&nbsp;${lunarMon}${lunarDay}`,document.getElementById("schedule-days").innerHTML=l}}